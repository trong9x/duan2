<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Qu·∫£n l√Ω s·ª£i</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
  background:#f2f3f5;
  padding:12px;
}

h2{
  text-align:center;
  margin:6px 0 12px;
  font-size:20px;
}

/* CARD */
.box{
  background:#fff;
  padding:12px;
  border-radius:14px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.05);
}

/* INPUT */
input{
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:10px;
  border:1px solid #ddd;
}

/* BUTTON */
button{
  padding:12px;
  font-size:15px;
  border:none;
  border-radius:10px;
  font-weight:600;
}

.add{background:#2ecc71;color:#fff}
.assign{background:#3498db;color:#fff}
.del{background:#e74c3c;color:#fff}

/* SEARCH STICKY */
.search-box{
  position:sticky;
  top:0;
  z-index:10;
}

/* LIST */
#soiList{
  list-style:none;
  padding:0;
  margin:0;
}

#soiList li{
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.06);
}

.soi-name{
  font-weight:600;
  font-size:16px;
  margin-bottom:6px;
}

.row{
  display:flex;
  gap:8px;
  align-items:center;
}

.qty-input{
  flex:1;
  padding:10px;
  font-size:16px;
  text-align:center;
}

.row button{
  min-width:70px;
}

/* MOBILE TOUCH */
button, input{
  touch-action:manipulation;
}
</style>
</head>

<body>

<h2>üßµ QU·∫¢N L√ù S·ª¢I</h2>

<!-- SEARCH -->
<div class="box search-box">
  <input id="searchSoi" placeholder="üîç G√µ 100 / 150 / 330">
</div>

<!-- ADD -->
<div class="box">
  <input id="soiName" placeholder="T√™n s·ª£i (VD: P-DTY100D/36)">
  <div style="height:8px"></div>
  <input id="soiQty" type="number" placeholder="S·ªë l∆∞·ª£ng">
  <div style="height:10px"></div>
  <button class="add" style="width:100%" onclick="addSoi()">‚ûï Th√™m s·ª£i</button>
</div>

<!-- LIST -->
<ul id="soiList"></ul>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAJ9dZW5b8WxF22cocPIB9bdsAGBHW-k",
  authDomain: "quan-ly-may-det.firebaseapp.com",
  databaseURL: "https://quan-ly-may-det-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "quan-ly-may-det"
});

const db = firebase.database();
const soiRef = db.ref("soi");

/* RENDER */
soiRef.on("value", snap=>{
  const list=document.getElementById("soiList");
  list.innerHTML="";

  snap.forEach(s=>{
    const v=s.val();
    const li=document.createElement("li");

    li.innerHTML=`
      <div class="soi-name">${v.name||""}</div>
      <div class="row">
        <input class="qty-input" type="number" value="${v.qty||0}">
        <button class="assign">G√°n</button>
        <button class="del">X</button>
      </div>
    `;
    list.appendChild(li);

    const qtyInput=li.querySelector(".qty-input");

    qtyInput.onblur=()=>{
      soiRef.child(s.key).update({qty:Number(qtyInput.value)||0});
    };
    qtyInput.onkeydown=e=>{if(e.key==="Enter")qtyInput.blur();};

    li.querySelector(".assign").onclick=()=>{
      db.ref("selected_soi").set({
        name:v.name,
        qty:Number(qtyInput.value)||0,
        time:Date.now()
      });
      alert("‚úÖ ƒê√£ g√°n s·ª£i");
    };

    li.querySelector(".del").onclick=()=>{
      if(confirm("X√≥a s·ª£i n√†y?")) soiRef.child(s.key).remove();
    };
  });

  filterSoi();
});

/* ADD */
function addSoi(){
  const name=soiName.value.trim();
  const qty=Number(soiQty.value)||0;
  if(!name)return alert("Nh·∫≠p t√™n s·ª£i");

  soiRef.push({name,qty,createdAt:Date.now()});
  soiName.value="";
  soiQty.value="";
}

/* FILTER */
function filterSoi(){
  const key=searchSoi.value.trim();
  document.querySelectorAll("#soiList li").forEach(li=>{
    const name=li.querySelector(".soi-name").innerText;
    const m=name.match(/(\d+)\s*D/i);
    const d=m?m[1]:"";
    li.style.display=d.startsWith(key)||!key?"":"none";
  });
}
searchSoi.oninput=filterSoi;
</script>

</body>
</html>


