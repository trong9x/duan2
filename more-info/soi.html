<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n l√Ω s·ª£i</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f5f5f5;
  padding:15px;
}
h2{margin-bottom:10px}
input,button{
  padding:8px;
  font-size:14px;
}
button{cursor:pointer}
.box{
  background:#fff;
  padding:10px;
  border-radius:6px;
  margin-bottom:10px;
}
#soiList li{
  background:#fff;
  margin-bottom:6px;
  padding:8px;
  border-radius:6px;
  display:flex;
  gap:6px;
  align-items:center;
}
#soiList input{flex:1}
.assign{
  background:#3498db;
  color:#fff;
  border:none;
}
.del{
  background:#e74c3c;
  color:#fff;
  border:none;
}
.add{
  background:#2ecc71;
  color:#fff;
  border:none;
}
</style>
</head>

<body>

<h2>üßµ QU·∫¢N L√ù S·ª¢I (CLICK G√ÅN)</h2>

<!-- SEARCH -->
<div class="box">
  <input id="searchSoi" placeholder="üîç G√µ 100 / 150 / 330 ..." style="width:100%">
</div>

<!-- ADD -->
<div class="box" style="display:flex;gap:6px">
  <input id="soiName" placeholder="T√™n s·ª£i (VD: P-DTY100D/36)">
  <input id="soiQty" type="number" placeholder="S·ªë l∆∞·ª£ng">
  <button class="add" onclick="addSoi()">‚ûï Th√™m</button>
</div>

<!-- LIST -->
<ul id="soiList" style="list-style:none;padding:0"></ul>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* üî• FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyAJ9dZW5b8WxF22cocPIB9bdsAGBHW-k",
  authDomain: "quan-ly-may-det.firebaseapp.com",
  databaseURL: "https://quan-ly-may-det-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "quan-ly-may-det"
});

const db = firebase.database();
const soiRef = db.ref("soi");

/* ===== RENDER ===== */
soiRef.on("value", snap => {
  const list = document.getElementById("soiList");
  list.innerHTML = "";

  snap.forEach(s => {
    const v = s.val();
    const li = document.createElement("li");

    li.innerHTML = `
      <input value="${v.name || ""}" readonly>
      <input class="qty-input" type="number" value="${v.qty || 0}">
      <button class="assign">G√°n</button>
      <button class="del">X</button>
    `;

    list.appendChild(li);

    const qtyInput = li.querySelector(".qty-input");

    /* üî• L∆ØU S·ªê L∆Ø·ª¢NG */
    qtyInput.onblur = () => {
      soiRef.child(s.key).update({
        qty: Number(qtyInput.value) || 0
      });
    };
    qtyInput.onkeydown = e => {
      if (e.key === "Enter") qtyInput.blur();
    };

    /* ‚úÖ G√ÅN S·ª¢I + S·ªê L∆Ø·ª¢NG */
    li.querySelector(".assign").onclick = e => {
      e.stopPropagation();
      db.ref("selected_soi").set({
        name: v.name,
        qty: Number(qtyInput.value) || 0,
        time: Date.now()
      });
      alert("‚úÖ ƒê√£ g√°n s·ª£i + s·ªë l∆∞·ª£ng");
    };

    /* ‚ùå XO√Å */
    li.querySelector(".del").onclick = e => {
      e.stopPropagation();
      if (confirm("X√≥a s·ª£i n√†y?")) {
        soiRef.child(s.key).remove();
      }
    };
  });

  filterSoi();
});

/* ===== ADD ===== */
function addSoi(){
  const name = soiName.value.trim();
  const qty  = Number(soiQty.value) || 0;
  if(!name) return alert("Nh·∫≠p t√™n s·ª£i");

  soiRef.push({
    name,
    qty,
    createdAt: Date.now()
  });

  soiName.value = "";
  soiQty.value = "";
}

/* ===== FILTER ===== */
function filterSoi(){
  const key = searchSoi.value.trim();
  document.querySelectorAll("#soiList li").forEach(li => {
    const name = li.children[0].value;
    const m = name.match(/(\d+)\s*D/i);
    const d = m ? m[1] : "";
    li.style.display = d.startsWith(key) ? "" : "none";
  });
}
searchSoi.oninput = filterSoi;
</script>

</body>
</html>
