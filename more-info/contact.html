<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Qu·∫£n l√Ω m√°y d·ªát</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:#f5f5f5;
  margin:0;
  padding:10px;
}
body.dark{background:#1e1e1e;color:#eee}

.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:6px;
}

.actions .btn{
  cursor:pointer;
  padding:6px 10px;
  background:#ddd;
  border-radius:6px;
}
body.dark .btn{background:#333}

#search{
  width:100%;
  padding:8px;
  margin:8px 0;
  font-size:16px;
}

#tip{font-size:13px;color:#c0392b}

.machine-card{
  border:1px solid #ccc;
  border-radius:8px;
  margin-bottom:10px;
  background:#fff;
}
body.dark .machine-card{
  background:#2b2b2b;
  border-color:#444;
}

.machine-header{
  background:#eee;
  padding:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:6px;
}
body.dark .machine-header{background:#3a3a3a}

.machine-title{
  font-weight:bold;
  cursor:pointer;
}

.machine-body{padding:10px}
.collapsed .machine-body{display:none}

.axle-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:8px;
}

.axle{
  border:1px solid #ccc;
  padding:8px;
  border-radius:6px;
  background:#fafafa;
}
body.dark .axle{background:#1f1f1f;border-color:#444}

.axle.warning{
  border-color:#e74c3c;
  background:#fdecea;
}
.axle.done{
  border-color:#2ecc71;
  background:#eafaf1;
}
body.dark .axle.done{background:#1e3b2c}

.axle input{
  width:100%;
  padding:8px;
  margin-bottom:6px;
  font-size:16px;
  box-sizing:border-box;
}

.note{font-size:12px}

/* ===== MOBILE ===== */
@media(max-width:768px){
  body{padding:6px;font-size:15px}
  .top-bar{flex-direction:column;align-items:stretch}
  .actions{display:flex;gap:6px;flex-wrap:wrap}
  .actions .btn{flex:1;padding:10px;font-size:14px}
  .machine-header{flex-direction:column;align-items:stretch}
  .axle-grid{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="top-bar">
  <h3 id="title"></h3>
  <div class="actions">
    <span class="btn" id="expandAll"></span>
    <span class="btn" id="collapseAll"></span>
    <span class="btn" id="toggleTheme"></span>
    <span class="btn" id="toggleLang"></span>
  </div>
</div>

<input id="search" placeholder="üîç T√¨m m√°y / ƒë∆°n h√†ng">
<p id="tip"></p>
<div id="machineContainer"></div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAJ9dZW5b8WxF22cocPIB9bdsAGBHW-k",
  authDomain:"quan-ly-may-det.firebaseapp.com",
  databaseURL:"https://quan-ly-may-det-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"quan-ly-may-det"
});
const db=firebase.database();
</script>

<script>
const TEXT={
vi:{
 title:"üìä QU·∫¢N L√ù M√ÅY D·ªÜT ‚Äì 8 TR·ª§C",
 expandAll:"üîº M·ªü t·∫•t c·∫£",
 collapseAll:"üîΩ Thu g·ªçn",
 dark:"üåô Dark",
 light:"‚òÄ Light",
 tip:"üîî Tr·ª•c d∆∞·ªõi 72H b·∫Øt bu·ªôc ghi v·ªã tr√≠",
 machine:"M√°y",
 order:"ƒê∆°n h√†ng",
 axle:"Tr·ª•c",
 material:"Nguy√™n li·ªáu",
 hour:"Gi·ªù ch·∫°y",
 location:"V·ªã tr√≠",
 warn:"‚ö† Ch∆∞a ƒë·ªß 72H"
},
zh:{
 title:"üìä ÁªáÊú∫ÁÆ°ÁêÜ ‚Äì 8ËΩ¥",
 expandAll:"üîº ÂÖ®ÈÉ®Â±ïÂºÄ",
 collapseAll:"üîΩ ÂÖ®ÈÉ®Êî∂Ëµ∑",
 dark:"üåô Â§úÈó¥",
 light:"‚òÄ Êó•Èó¥",
 tip:"üîî Â∞ë‰∫é72Â∞èÊó∂ÂøÖÈ°ªÂ°´ÂÜô‰ΩçÁΩÆ",
 machine:"Êú∫Âô®",
 order:"ËÆ¢Âçï",
 axle:"ËΩ¥",
 material:"ÂéüÊñô",
 hour:"ËøêË°åÂ∞èÊó∂",
 location:"‰ΩçÁΩÆ",
 warn:"‚ö† Êú™Êª°72Â∞èÊó∂"
}
};

let lang=localStorage.getItem("lang")||"vi";
if(localStorage.getItem("theme")==="dark")
 document.body.classList.add("dark");

toggleTheme.onclick=()=>{
 document.body.classList.toggle("dark");
 localStorage.setItem("theme",
  document.body.classList.contains("dark")?"dark":"light");
 applyLang();
};

toggleLang.onclick=()=>{
 lang=lang==="vi"?"zh":"vi";
 localStorage.setItem("lang",lang);
 render();
};

function applyLang(){
 const t=TEXT[lang];
 title.textContent=t.title;
 expandAll.textContent=t.expandAll;
 collapseAll.textContent=t.collapseAll;
 tip.textContent=t.tip;
 toggleTheme.textContent=
  document.body.classList.contains("dark")?t.light:t.dark;
 toggleLang.textContent=lang==="vi"?"‰∏≠Êñá":"VI";
}

const MACHINES=[];
for(let i=1101;i<=1160;i++)MACHINES.push(i);
const AXLES=8;
const container=document.getElementById("machineContainer");

function render(){
 container.innerHTML="";
 applyLang();
 const t=TEXT[lang];

 MACHINES.forEach(machine=>{
  const card=document.createElement("div");
  card.className="machine-card";
  if(localStorage.getItem("collapse-"+machine)==="1")
    card.classList.add("collapsed");
  if(window.innerWidth<768)
    card.classList.add("collapsed");

  card.innerHTML=`
   <div class="machine-header">
    <span class="machine-title">${t.machine} ${machine}</span>
    <input class="order-input" placeholder="${t.order}">
   </div>
   <div class="machine-body"><div class="axle-grid"></div></div>
  `;

  const orderInput=card.querySelector(".order-input");
  db.ref("machines/"+machine+"/order")
    .on("value",s=>orderInput.value=s.val()||"");
  orderInput.oninput=()=>db.ref("machines/"+machine+"/order")
    .set(orderInput.value);

  card.querySelector(".machine-title")
   .addEventListener("pointerdown",()=>{
    card.classList.toggle("collapsed");
    localStorage.setItem("collapse-"+machine,
     card.classList.contains("collapsed")?"1":"0");
   });

  const grid=card.querySelector(".axle-grid");

  for(let a=1;a<=AXLES;a++){
   const axle=document.createElement("div");
   axle.className="axle";
   axle.innerHTML=`
    <b>${t.axle} ${a}</b>
    <input placeholder="${t.material}">
    <input type="number" placeholder="${t.hour}">
    <input placeholder="${t.location}">
    <div class="note"></div>
   `;

   const [mat,hr,loc]=axle.querySelectorAll("input");
   const note=axle.querySelector(".note");

   db.ref(`machines/${machine}/axles/${a}`)
    .on("value",s=>{
     if(!s.exists())return;
     const d=s.val();
     mat.value=d.material||"";
     hr.value=d.hour||"";
     loc.value=d.location||"";
     axle.classList.remove("warning","done");
     if(d.hour&&d.hour<72){
       axle.classList.add("warning");
       note.textContent=t.warn;
       mat.disabled=false;loc.disabled=false;
     }else if(d.hour>=72){
       axle.classList.add("done");
       note.textContent="‚úÖ OK";
       mat.disabled=true;loc.disabled=true;
     }else note.textContent="";
    });

   axle.oninput=()=>{
    db.ref(`machines/${machine}/axles/${a}`).set({
     material:mat.value,
     hour:hr.value,
     location:loc.value,
     updatedAt:Date.now()
    });
   };

   grid.appendChild(axle);
  }

  container.appendChild(card);
 });
}

expandAll.onclick=()=>document
 .querySelectorAll(".machine-card")
 .forEach(c=>c.classList.remove("collapsed"));

collapseAll.onclick=()=>document
 .querySelectorAll(".machine-card")
 .forEach(c=>c.classList.add("collapsed"));

search.oninput=()=>{
 const q=search.value.toLowerCase();
 document.querySelectorAll(".machine-card").forEach(c=>{
  c.style.display=c.innerText.toLowerCase().includes(q)?"":"none";
 });
};

document.addEventListener("focusin",e=>{
 if(e.target.tagName==="INPUT"){
  setTimeout(()=>e.target.scrollIntoView({
   behavior:"smooth",block:"center"
  }),300);
 }
});

render();
</script>

</body>
</html>



