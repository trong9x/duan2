<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Qu·∫£n l√Ω m√°y d·ªát</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 10px;
    }

    body.dark {
      background: #1e1e1e;
      color: #eee;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .actions .btn {
      cursor: pointer;
      padding: 6px 10px;
      background: #ddd;
      border-radius: 6px;
      display: inline-block;
    }

    body.dark .btn {
      background: #333;
    }

    #tip {
      margin: 8px 0;
      font-size: 13px;
      color: #c0392b;
    }

    .machine-card {
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 10px;
      background: #fff;
      overflow: hidden;
    }

    body.dark .machine-card {
      background: #2b2b2b;
      border-color: #444;
    }

    .machine-header {
      background: #eee;
      padding: 8px;
      display: flex;
      justify-content: space-between;
      cursor: pointer;
      align-items: center;
    }

    body.dark .machine-header {
      background: #3a3a3a;
    }

    .machine-body {
      padding: 10px;
    }

    .collapsed .machine-body {
      display: none;
    }

    .axle-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 8px;
    }

    .axle {
      border: 1px solid #ccc;
      padding: 6px;
      border-radius: 6px;
      background: #fafafa;
    }

    body.dark .axle {
      background: #1f1f1f;
      border-color: #444;
    }

    .axle.warning {
      border-color: #e74c3c;
      background: #fdecea;
    }

    .axle input {
      width: 100%;
      margin-bottom: 4px;
      padding: 4px;
      box-sizing: border-box;
    }

    .note {
      font-size: 12px;
      color: #e74c3c;
    }
  </style>
</head>

<body>

<div class="top-bar">
  <h3 id="title"></h3>
  <div class="actions">
    <span class="btn" id="expandAll"></span>
    <span class="btn" id="collapseAll"></span>
    <span class="btn" id="toggleTheme"></span>
    <span class="btn" id="toggleLang"></span>
  </div>
</div>

<p id="tip"></p>
<div id="machineContainer"></div>

<!-- ================= FIREBASE ================= -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAJ9dZW5b8WxF22cocPIB9bdsAGBHW-k",
    authDomain: "quan-ly-may-det.firebaseapp.com",
    databaseURL: "https://quan-ly-may-det-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "quan-ly-may-det",
    storageBucket: "quan-ly-may-det.firebasestorage.app",
    messagingSenderId: "661540513500",
    appId: "1:661540513500:web:181366e3e91dbb4a81f619"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>
<!-- =============== /FIREBASE ================= -->

<script>
/* ===== NG√îN NG·ªÆ ===== */
const TEXT = {
  vi: {
    title: "üìä QU·∫¢N L√ù M√ÅY D·ªÜT ‚Äì 8 TR·ª§C",
    expandAll: "üîº M·ªü t·∫•t c·∫£",
    collapseAll: "üîΩ Thu g·ªçn t·∫•t c·∫£",
    dark: "üåô Dark",
    light: "‚òÄ Light",
    tip: "üîî Tr·ª•c d∆∞·ªõi 72H b·∫Øt bu·ªôc ghi v·ªã tr√≠ con su·ªët",
    machine: "M√°y",
    order: "ƒê∆°n h√†ng",
    axle: "Tr·ª•c",
    material: "Nguy√™n li·ªáu",
    hour: "Gi·ªù ch·∫°y",
    location: "V·ªã tr√≠",
    warn: "‚ö† Ch∆∞a ƒë·ªß 72H"
  },
  zh: {
    title: "üìä ÁªáÊú∫ÁÆ°ÁêÜ ‚Äì 8ËΩ¥",
    expandAll: "üîº ÂÖ®ÈÉ®Â±ïÂºÄ",
    collapseAll: "üîΩ ÂÖ®ÈÉ®Êî∂Ëµ∑",
    dark: "üåô Â§úÈó¥",
    light: "‚òÄ Êó•Èó¥",
    tip: "üîî ËøêË°åÊó∂Èó¥Â∞ë‰∫é72Â∞èÊó∂ÂøÖÈ°ªÂ°´ÂÜô‰ΩçÁΩÆ",
    machine: "Êú∫Âô®",
    order: "ËÆ¢Âçï",
    axle: "ËΩ¥",
    material: "ÂéüÊñô",
    hour: "ËøêË°åÂ∞èÊó∂",
    location: "‰ΩçÁΩÆ",
    warn: "‚ö† Êú™Êª°72Â∞èÊó∂"
  }
};

let lang = localStorage.getItem("lang") || "vi";

/* ===== FIREBASE HELPERS ===== */
const saveAxle = (m, a, d) =>
  db.ref(`machines/${m}/axles/${a}`).set(d);

const listenAxle = (m, a, cb) =>
  db.ref(`machines/${m}/axles/${a}`).on("value", s => s.exists() && cb(s.val()));

const saveOrder = (m, v) =>
  db.ref(`machines/${m}/order`).set(v);

const listenOrder = (m, cb) =>
  db.ref(`machines/${m}/order`).on("value", s => s.exists() && cb(s.val()));

/* ===== THEME ===== */
if (localStorage.getItem("theme") === "dark") document.body.classList.add("dark");
toggleTheme.onclick = () => {
  document.body.classList.toggle("dark");
  localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
  applyLang();
};

/* ===== APPLY LANG ===== */
function applyLang() {
  const t = TEXT[lang];
  title.textContent = t.title;
  expandAll.textContent = t.expandAll;
  collapseAll.textContent = t.collapseAll;
  tip.textContent = t.tip;
  toggleTheme.textContent = document.body.classList.contains("dark") ? t.light : t.dark;
  toggleLang.textContent = lang === "vi" ? "‰∏≠Êñá" : "VI";
}

toggleLang.onclick = () => {
  lang = lang === "vi" ? "zh" : "vi";
  localStorage.setItem("lang", lang);
  render();
};

/* ===== DATA ===== */
const MACHINES = [];
for (let m = 1101; m <= 1160; m++) MACHINES.push(m);
const AXLES = 8;
const container = document.getElementById("machineContainer");

/* ===== RENDER ===== */
function render() {
  container.innerHTML = "";
  applyLang();
  const t = TEXT[lang];

  MACHINES.forEach(machine => {
    const card = document.createElement("div");
    card.className = "machine-card";
    if (localStorage.getItem("collapse-" + machine) === "1") card.classList.add("collapsed");

    card.innerHTML = `
      <div class="machine-header">
        <strong>${t.machine} ${machine}</strong>
        <input class="order-input" placeholder="${t.order}">
      </div>
      <div class="machine-body"><div class="axle-grid"></div></div>
    `;

    const orderInput = card.querySelector(".order-input");
    listenOrder(machine, v => orderInput.value = v);
    orderInput.oninput = () => saveOrder(machine, orderInput.value);

    const grid = card.querySelector(".axle-grid");

    for (let i = 1; i <= AXLES; i++) {
      const axle = document.createElement("div");
      axle.className = "axle";
      axle.innerHTML = `
        <b>${t.axle} ${i}</b>
        <input placeholder="${t.material}">
        <input type="number" placeholder="${t.hour}">
        <input placeholder="${t.location}">
        <div class="note"></div>
      `;
      const [mat, hr, loc] = axle.querySelectorAll("input");
      const note = axle.querySelector(".note");

      listenAxle(machine, i, d => {
        mat.value = d.material || "";
        hr.value = d.hour || "";
        loc.value = d.location || "";
      });

      axle.oninput = () => {
        const h = Number(hr.value);
        if (h && h < 72) {
          axle.classList.add("warning");
          note.textContent = t.warn;
        } else {
          axle.classList.remove("warning");
          note.textContent = "";
        }
        saveAxle(machine, i, {
          material: mat.value,
          hour: hr.value,
          location: loc.value
        });
      };

      grid.appendChild(axle);
    }

    card.querySelector(".machine-header").onclick = () => {
      card.classList.toggle("collapsed");
      localStorage.setItem("collapse-" + machine, card.classList.contains("collapsed") ? "1" : "0");
    };

    container.appendChild(card);
  });
}

expandAll.onclick = () => {
  document.querySelectorAll(".machine-card").forEach(c => c.classList.remove("collapsed"));
};

collapseAll.onclick = () => {
  document.querySelectorAll(".machine-card").forEach(c => c.classList.add("collapsed"));
};

render();
</script>

</body>
</html>

