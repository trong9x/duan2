<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>S·∫£n l∆∞·ª£ng</title>
<link rel="shortcut icon" href="https://flashcards.world/favicon.ico" type="image/x-icon">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f2f2f2}

/* HEADER */
.header{
  position:fixed;top:0;left:0;right:0;height:56px;
  background:#2980b9;color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:18px;font-weight:bold;z-index:10;
}

/* CONTENT */
.content{padding:70px 10px}
.card{
  background:#fff;border-radius:16px;
  margin-bottom:12px;padding:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.12);
}
.row{font-size:14px;margin:4px 0}
.row b{color:#555}
.del{
  margin-top:8px;background:#e74c3c;color:#fff;
  border:none;border-radius:10px;padding:8px 12px
}
</style>
</head>

<body>

<div class="header">üìä S·∫£n l∆∞·ª£ng</div>
<div class="content" id="list"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAJ9dZW5b8WxF22cocPIB9bdsAGBHW-k",
  databaseURL:"https://quan-ly-may-det-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();
const list=document.getElementById("list");

db.ref("production").on("value", snap=>{
  list.innerHTML="";
  const raw=snap.val()||{};
  let rows=[];

  Object.keys(raw).forEach(m=>{
    Object.keys(raw[m]).forEach(a=>{
      Object.keys(raw[m][a]).forEach(id=>{
        const d=raw[m][a][id];
        if(!d) return;

        rows.push({ m, a, id, d });
      });
    });
  });

  /* üî• S·∫Øp x·∫øp m·ªõi ‚Üí c≈© */
  rows.sort((x,y)=>(y.d.createdAt||0)-(x.d.createdAt||0));

  rows.forEach(({m,a,id,d})=>{
    const mat=d.material||{};
    const card=document.createElement("div");
    card.className="card";

    card.innerHTML=`
      <div class="row"><b>Ng√†y:</b> ${d.date||""}</div>

      <div class="row">
        <b>M√°y:</b> ${m} |
        <b>Tr·ª•c:</b> ${a.replace("axle_","")}
      </div>

      <div class="row"><b>QR:</b> ${mat.qr||""}</div>
      <div class="row"><b>Nguy√™n li·ªáu:</b> ${mat.name||""}</div>

      <div class="row">
        <b>S·ªë l√¥:</b> ${mat.lot||""} |
        <b>S·ª£i:</b> ${mat.fiber||""}
      </div>

      <div class="row"><b>S·ªë m√©t:</b> ${mat.meter||""}</div>

      <div class="row"><b>V·ªã tr√≠:</b> ${d.position||""}</div>

      <div class="row">
        <b>SL:</b> ${d.quantity||0} |
        <b>Ca:</b> ${d.shift||""}
      </div>

      <div class="row"><b>Ng∆∞·ªùi:</b> ${d.person||""}</div>

      <button class="del" onclick="del('${m}','${a}','${id}')">‚ùå X√≥a</button>
    `;
    list.appendChild(card);
  });
});

function del(m,a,id){
  if(!confirm("X√≥a d√≤ng n√†y?")) return;
  db.ref(`production/${m}/${a}/${id}`).remove();
}
</script>

</body>
</html>
