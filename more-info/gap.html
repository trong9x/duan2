<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç´§æ€¥è®¢å• | Báº£ng Ä‘Æ¡n hÃ ng gáº¥p</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
  .action-col{
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:center;
}
.action-col button{
  width:42px;
  height:36px;
  border-radius:8px;
}

:root{
  --blue:#2563eb;
  --blue-dark:#1e40af;
  --green:#22c55e;
  --yellow:#facc15;
  --red:#ef4444;
  --gray:#6b7280;
}

body{font-family:Arial;background:#f4f6f8;padding:16px}
h2{text-align:center;margin-bottom:10px}

/* ===== INPUT ===== */
input,select,button{
  padding:8px;
  border-radius:6px;
  border:1px solid #c7d2fe
}
button{border:none;font-weight:600;cursor:pointer}

/* ===== BUTTON ===== */
.add-btn{background:var(--green);color:#fff}
.save-btn{background:#0ea5e9;color:#fff}
.done-btn{background:#22c55e;color:#fff}
.edit{background:#facc15}
.delete{background:var(--red);color:#fff}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:10px;
  overflow:hidden
}
th,td{
  padding:8px;
  border-bottom:1px solid #e5e7eb;
  text-align:center
}
th{
  background:linear-gradient(90deg,var(--blue),var(--blue-dark));
  color:#fff
}

/* ===== TRáº NG THÃI ===== */
.done{
  background:#f1f5f9;
  color:var(--gray);
  text-decoration:line-through
}

/* ===== Cáº¢NH BÃO ===== */
.level-green{background:#f0fdf4}
.level-yellow{background:#fffbeb}
.level-red{
  background:#fee2e2;
  animation:blink 1.2s infinite;
  font-weight:bold;
}
@keyframes blink{
  0%{background:#fee2e2}
  50%{background:#fecaca}
  100%{background:#fee2e2}
}

/* ===== KHÃC ===== */
.position-box{
  background:#ecfeff;
  border:1px solid #67e8f9;
  color:#0e7490;
  padding:4px 8px;
  border-radius:6px;
  font-weight:600
}
.locked{
  padding:6px 12px;
  background:#e5e7eb;
  border-radius:999px;
  font-size:12px;
  font-weight:600
}

/* ===== MOBILE ===== */
@media(max-width:768px){
  table{display:block}
  thead{display:none}

  tbody{display:block}
  tbody tr{
    display:block;
    margin-bottom:14px;
    background:#fff;
    border-radius:12px;
    padding:10px;
  }

  tbody td{
    display:flex;
    justify-content:space-between;
    border:none;
    padding:4px 0;
  }
  tbody td::before{
    font-weight:600;
    color:#374151;
  }
  tbody td:nth-child(1)::before{content:"è®¢å•";}
  tbody td:nth-child(2)::before{content:"æœºå™¨";}
  tbody td:nth-child(3)::before{content:"åŸæ–™";}
  tbody td:nth-child(4)::before{content:"æ•°é‡";}
  tbody td:nth-child(5)::before{content:"æ—¥æœŸ";}
  tbody td:nth-child(6)::before{content:"ç±³æ•°";}
  tbody td:nth-child(7)::before{content:"å‘˜å·¥";}
  tbody td:nth-child(8)::before{content:"é”­ä½";}
  tbody td:nth-child(9)::before{content:"çŠ¶æ€";}
}
</style>
</head>

<body>

<h2>ğŸ“¦ ç´§æ€¥è®¢å• | Báº£ng Ä‘Æ¡n hÃ ng gáº¥p</h2>

<table>
<thead>
<tr>
  <th>è®¢å•</th><th>æœºå™¨</th><th>åŸæ–™</th><th>æ•°é‡</th>
  <th>æ—¥æœŸ</th><th>ç±³æ•°</th><th>å‘˜å·¥</th>
  <th>é”­ä½</th><th>çŠ¶æ€</th><th>æ“ä½œ</th>
</tr>
</thead>

<tbody>
<tr>
  <td><input id="orderName"></td>
  <td><input id="machine"></td>
  <td><input id="material"></td>
  <td><input id="quantity" type="number"></td>
  <td><input id="date" type="date"></td>
  <td><input id="meters" type="number"></td>
  <td>
    <select id="worker">
      <option value="">-- Chá»n NV --</option>
    </select>
  </td>
  <td><i>HoÃ n thÃ nh má»›i nháº­p</i></td>
  <td>â³</td>
  <td><button id="addBtn" class="add-btn">æ·»åŠ </button></td>
</tr>
</tbody>

<tbody id="tableBody"></tbody>
</table>

<script>
// ================== Cáº¤U HÃŒNH ==================
const ADMIN_PASSWORD = "123456";

// ================== NHÃ‚N VIÃŠN ==================
const workers=["Chá»‹ Lan","Anh Tuáº¥n","Anh HÃ¹ng","Chá»‹ Hoa","Anh Nam"];

// ================== FIREBASE ==================
firebase.initializeApp({
  apiKey:"AIzaSyAJ9dZW5b8WxF22cocPIB9bdsAGBHW-k",
  databaseURL:"https://quan-ly-may-det-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const soiRef=firebase.database().ref("soi");

// ================== DOM ==================
const orderName=document.getElementById("orderName");
const machine=document.getElementById("machine");
const material=document.getElementById("material");
const quantity=document.getElementById("quantity");
const date=document.getElementById("date");
const meters=document.getElementById("meters");
const worker=document.getElementById("worker");
const tableBody=document.getElementById("tableBody");
const addBtn=document.getElementById("addBtn");

let editKey=null;
let alerted=false;
date.valueAsDate=new Date();

// load NV
workers.forEach(n=>{
  const o=document.createElement("option");
  o.value=n;o.textContent=n;
  worker.appendChild(o);
});

// ADD
addBtn.onclick=()=>{
  if(!orderName.value||!machine.value||!material.value||
     !quantity.value||!date.value||!meters.value||!worker.value){
    alert("è¯·è¾“å…¥å®Œæ•´ä¿¡æ¯ / Nháº­p Ä‘á»§ thÃ´ng tin");
    return;
  }

  const data={
    orderName:orderName.value,
    machine:machine.value,
    material:material.value,
    quantity:quantity.value,
    date:date.value,
    meters:meters.value,
    worker:worker.value
  };

  // ğŸ”´ Náº¾U ÄANG Sá»¬A â†’ UPDATE
  if(editKey){
    soiRef.child(editKey).update(data);
    editKey = null;
    addBtn.textContent = "æ·»åŠ ";
    addBtn.className   = "add-btn";
  }
  // ğŸŸ¢ Náº¾U THÃŠM Má»šI â†’ PUSH
  else{
    soiRef.push({
      ...data,
      position:"",
      done:false,
      createdAt:Date.now()
    });
  }

  // reset form
  orderName.value=machine.value=material.value=
  quantity.value=meters.value=worker.value="";
  date.valueAsDate=new Date();
};

// LOAD
soiRef.on("value",s=>{
  render(s.val());
  alertRed(s.val());
});

// RENDER
function render(data){
  tableBody.innerHTML="";
  if(!data) return;

  Object.entries(data).forEach(([k,o])=>{
    const tr=document.createElement("tr");
    const diff=(Date.now()-new Date(o.date))/86400000;

    if(!o.done){
      if(diff>=5) tr.classList.add("level-red");
      else if(diff>=2) tr.classList.add("level-yellow");
      else tr.classList.add("level-green");
    }
    if(o.done) tr.classList.add("done");

    tr.innerHTML=`
      <td>${o.orderName}</td>
      <td>${o.machine}</td>
      <td>${o.material}</td>
      <td>${o.quantity}</td>
      <td>${o.date}</td>
      <td>${o.meters} m</td>
      <td>${o.worker}</td>
      <td>${o.position||"-"}</td>
      <td>${o.done?"ğŸŸ¢ å·²å®Œæˆ":"âš ï¸ ç´§æ€¥ / Gáº¥p"}</td>

      <td>
        <div class="action-col">
          ${
            o.done
            ? `<span class="locked">ğŸ”’</span>`
            : `
              <button class="done-btn" title="HoÃ n thÃ nh"
                onclick="done('${k}')">âœ”</button>

              <button class="edit" title="Sá»­a"
                onclick="editRow('${k}')">âœï¸</button>
            `
          }
          <button class="delete" title="XoÃ¡"
            onclick="del('${k}')">ğŸ—‘ï¸</button>
        </div>
      </td>
    `;
    tableBody.appendChild(tr);
  });
}

// DONE
function done(key){
  const pos=prompt("ğŸ“¦ è¾“å…¥é”­ä½ / Nháº­p vá»‹ trÃ­ con suá»‘t");
  if(!pos) return;
  soiRef.child(key).update({done:true,position:pos});
}

// DELETE
function del(k){
  const pw=prompt("ğŸ” è¾“å…¥ç®¡ç†å‘˜å¯†ç  / Nháº­p máº­t kháº©u quáº£n lÃ½");
  if(pw!==ADMIN_PASSWORD) return alert("âŒ Sai máº­t kháº©u");
  if(confirm("XoÃ¡ Ä‘Æ¡n nÃ y?")) soiRef.child(k).remove();
}

// ALERT ÄÆ N Äá»
function alertRed(data){
  if(alerted||!data) return;
  const n=Object.values(data).filter(o=>{
    const d=(Date.now()-new Date(o.date))/86400000;
    return !o.done && d>=5;
  }).length;
  if(n>0){
    alerted=true;
    alert(`âš ï¸ æœ‰ ${n} ä¸ªçº¢è‰²è®¢å•ï¼\nCÃ³ ${n} Ä‘Æ¡n quÃ¡ háº¡n!`);
  }
}
function editRow(key){
  soiRef.child(key).once("value", snap=>{
    const o = snap.val();

    if(o.done){
      alert("âŒ å·²å®Œæˆè®¢å•ä¸èƒ½ä¿®æ”¹\nÄÆ¡n Ä‘Ã£ hoÃ n thÃ nh khÃ´ng Ä‘Æ°á»£c sá»­a");
      return;
    }

    editKey = key;

    orderName.value = o.orderName;
    machine.value   = o.machine;
    material.value  = o.material;
    quantity.value  = o.quantity;
    date.value      = o.date;
    meters.value    = o.meters;
    worker.value    = o.worker;

    addBtn.textContent = "ğŸ’¾ ä¿å­˜ / LÆ°u";
    addBtn.className   = "save-btn";
  });
}

</script>

</body>
</html>


